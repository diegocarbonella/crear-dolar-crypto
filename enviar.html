<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Envío de transacciones</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js" type="application/javascript"></script>
</head>
<body class = "bg-secondary text-white">

    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="collapsse navbar-collaps" id="navbarNavAltMarkup">
          <div class="navbar-nav">
            <a class="nav-item nav-link" href="index.html">Ver mis tokens</a>
            <a class="nav-item nav-link" href="enviar.html">Enviar tokens</a>
            <a class="nav-item nav-link active" href="crear.html">Crear tokens</a>
          </div>
        </div>
    </nav>

    <div class = "text-center mb-5 mt-3">
        <img class = "d-inline-block" style = "width:30px" src="https://upload.wikimedia.org/wikipedia/commons/3/36/MetaMask_Fox.svg" alt="">
        <label class = "form-text text-white" id = "metamaskNetwork">Metamask está desconectado</label>
    </div>

    <div class = "w-75 mx-auto h-100">

        <h4 class ="h4 text-center">Nueva transacción</h4>
 
        <label class = "d-inline-block">Dirección de partida</label>
        <input class = "ds-block w-100 form-control" placeholder = "0x..." id="from">
        <p class = "d-isnline-block form-text text-white">Saldo: <span id= "balanceFrom"></span></p>
    
        <label class = "d-inline-block">Dirección del contrato</label>
        <input class = "d-bslock w-100 form-control" type="text" placeholder = "0x..." id="contract">
        <p class = "d-sinline-block form-text text-white">Contrato</p>

        <label class = "d-inline-block">Dirección de destino</label>
        <input class = "d-bslock w-100 form-control" type="text" placeholder = "0x..." id="to">
        <p class = "d-sinline-block form-text text-white">Saldo: <span id= "balanceTo"></span></p>
    
        <label class = "d-inline-block">Cantidad de tokens</label>
        <input class = "d-block w-100 mb-3 form-control" type="text" placeholder = "0" id="quantity">
        <button type="button" class="btn btn-success form-text text-white" id = "send">Enviar</button>


    </div>
    
</body>
</html>

<script src="index.js"></script>

<script>

$(document).ready( async () => {

if (window.ethereum == undefined) {

    $("#from").attr("disabled", true);
    $("#to").attr("disabled", true);
    $("#contract").attr("disabled", true);
    $("#quantity").attr("disabled", true);
    $("#send").attr("disabled", true);

    $("#metamaskNetwork").text("Metamask no está instalado");
    return;
    
}

const network = await getNetwork();
$("#metamaskNetwork").text("Metamask está conectado a la red " + network);

updateFromBalance();
updateToBalance();

$("#to").change( async () => {

    updateToBalance();

})

$("#network").change( async () => {

    changeNetwork();

})

$("#from").change( async () => {

    updateFromBalance();

})

$("#send").click(async () => {

    let toAddress           = $("#to").val();
    let quantity            = $("#quantity").val();
    let contractAddress     = $("#contract").val();
    let network             = $("#network").val();

    let resultado = await sendTransaction(toAddress, quantity, contractAddress, network);

    console.log("resultado", resultado)

    updateFromBalance();
    updateToBalance();

})

});

</script>
