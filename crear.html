<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crear Tokens</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.ethers.io/lib/ethers-5.2.umd.min.js" type="application/javascript"></script>
</head>
<body class = "text-white">

    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="collapsse navbar-collaps" id="navbarNavAltMarkup">
          <div class="navbar-nav">
            <a class="nav-item nav-link" href="index.html">Ver mis tokens</a>
            <a class="nav-item nav-link active" href="enviar.html">Enviar tokens</a>
            <a class="nav-item nav-link active" href="crear.html">Crear tokens</a>
            <a class="nav-item nav-link" href="https://faucet.egorfine.com/">Faucet</a>
          </div>
        </div>
    </nav>

    <div class = "text-center mb-3 mt-3">
        <label class = "form-text text-white" id = "metamaskNetwork">Metamask está desconectado</label>
        <br>
        <button class = "mt-3 text-white p-2" style = "background-color: #410D2E; border: 0px;" onclick="buscarYmostrar()">
            <img class = "d-inline-block" style = "width:30px; background-color: #410D2E" src="https://upload.wikimedia.org/wikipedia/commons/3/36/MetaMask_Fox.svg" alt="">
            Reconectar
        </button>
    </div>

    <div class = "w-75 mx-auto h-100">

        <form id = "create_tokens">

            <h4 class ="h4 text-center">Crear token</h4>
    
            <label class for="d-inline-block">Tipo de token:</label>
            <br>
            <select class = "form-select w-100" id="tipoToken" name="tipoToken">
              <option disabled value="Porciones.sol">Porciones</option>
              <option disabled value="Votos.sol">Votos</option>
              <option value="Monedas.sol">Monedas</option>
              <!-- <option value="Greeter.sol">Saludador</option> -->
            </select> 

            <label class = "d-inline-block">Nombre del token</label>
            <input name = "nombreDelToken" class = "ds-block w-100 form-control" required placeholder = "EjemploCoin" id="from" maxlength="6">
    
            <label class = "d-inline-block">Abreviación</label>
            <input name = "abreviacion" class = "ds-block w-100 form-control" required placeholder = "ECN" id="from" maxlength="3">
    
    
            <label class = "d-inline-block">Cuántas fichas?</label>
            <input id="cantidadFichas" name="cantidadFichas" required class = "ds-block w-100 form-control" value = "1000" id="from">
    
            <button onclick="enviar()" style = "background-color: #410D2E" class="btn btn-success form-text text-white">Enviar</button>

        </form>

        <p class = "mt-2" id = "messageResult"></p>
        <p class = "mt-2" id = "gasPesos"></p>

    </div>

    <p>Versión 1.0</p>
	
<script src="index.js"></script>
<script>
$("#create_tokens").submit(function(e) {
    e.preventDefault();
});

enviar = async function() {

    form = $("#create_tokens");

    data = form.serializeArray();

    console.log("data", data);

    $("#messageResult").text("Procesando la transacción...");

    try {

        if (data[1].value == "" || data[2].value == "" || data[3].value == "") {

            throw "No completaste todos los datos...";

        } 

        contract = await createToken(data[1].value, data[2].value, data[3].value);
        
        $("#messageResult").text("Dirección de contrato " + contract.address);

        //TODO: agregar el precio del gwei en pesos y dólares... y que te calcule apróx cuánto sale

        // ethereumPrice = 1087.24;
        // dollarPrice = 236;
        // gas = parseInt(temp0.deployTransaction.gasPrice._hex);

        // yourTokens = JSON.parse(localStorage.tokens2);
        // yourTokens.push(contract.address);

        // localStorage.setItem("tokens2", JSON.stringify(yourTokens));

        // $("#gasPesos").text("Gastaste $" + ethereumPrice*dollarPrice* pesos + " en GAS.");

    } catch (error) {

        console.log(error);
        $("#messageResult").text("Hubo un error! ... " + error);
        
    }

}


$(document).ready( async () => {

    if (window.ethereum == undefined) {
    
        $("#from").attr("disabled", true);
        $("#to").attr("disabled", true);
        $("#contract").attr("disabled", true);
        $("#quantity").attr("disabled", true);
        $("#send").attr("disabled", true);
    
        $("#metamaskNetwork").text("Metamask no está instalado");
        return;
        
    }

    const network = await getNetwork();
    $("#metamaskNetwork").text("Metamask está conectado a la red " + network);

});
</script>
</body>
</html>

